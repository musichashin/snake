<!DOCTYPE html>
<html>
<head>
  <title>Neon Bounce STABLE</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <style>
    body {
      margin: 0;
      background: #050505;
      overflow: hidden;
      font-family: 'Courier New', sans-serif;
      touch-action: none;
      user-select: none;
    }
    canvas {
      display: block;
      width: 100%;
      height: 100%;
    }
    #ui-layer {
      position: absolute;
      top: 20px;
      left: 20px;
      color: #ff0044;
      font-size: 24px;
      font-weight: bold;
      text-shadow: 0 0 10px #f00;
      pointer-events: none;
    }
    #controls {
      position: absolute;
      bottom: 20px;
      width: 100%;
      display: flex;
      justify-content: space-between;
      padding: 0 20px;
      box-sizing: border-box;
      pointer-events: none;
    }
    .btn {
      width: 80px;
      height: 80px;
      background: rgba(255, 255, 255, 0.1);
      border: 2px solid #555;
      border-radius: 50%;
      color: white;
      font-size: 30px;
      display: flex;
      align-items: center;
      justify-content: center;
      pointer-events: auto;
      backdrop-filter: blur(5px);
    }
    .btn:active { background: rgba(255, 0, 68, 0.4); border-color: #f04; }
    .right-controls { display: flex; }
    .left-controls { display: flex; gap: 15px; }
  </style>
</head>
<body>

<div id="ui-layer">LEVEL <span id="levelDisplay">1</span></div>
<canvas id="gameCanvas"></canvas>

<div id="controls">
  <div class="left-controls">
    <div class="btn" id="btnLeft">‚Üê</div>
    <div class="btn" id="btnRight">‚Üí</div>
  </div>
  <div class="right-controls">
    <div class="btn" id="btnJump">ü¶ò</div>
  </div>
</div>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const levelDisplay = document.getElementById('levelDisplay');

// --- –§–ò–ó–ò–ö–ê (–°–¢–ê–ë–ò–õ–¨–ù–ê–Ø) ---
let width, height;
const gravity = 0.6; 
const friction = 0.85; 
const jumpForce = -13; // –í—Å–µ–≥–¥–∞ –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π –ø—Ä—ã–∂–æ–∫
const moveSpeed = 6;

// --- –£–†–û–í–ù–ò ---
const levels = [
  // –£–†–û–í–ï–ù–¨ 1: –ü–æ–ª —ç—Ç–æ –ª–∞–≤–∞ (–ö–ª–∞—Å—Å–∏–∫–∞)
  [
    {x: 0, y: 300, w: 200, h: 50, type: 'block'}, 
    {x: 0, y: 400, w: 3000, h: 50, type: 'danger'}, 
    
    {x: 300, y: 250, w: 80, h: 20, type: 'block'},
    {x: 550, y: 200, w: 80, h: 20, type: 'block'}, 
    {x: 800, y: 150, w: 80, h: 20, type: 'block'},
    {x: 1100, y: 250, w: 80, h: 20, type: 'block'}, 
    {x: 1350, y: 300, w: 80, h: 20, type: 'block'}, 
    {x: 1600, y: 200, w: 50, h: 20, type: 'block'}, 
    {x: 1800, y: 250, w: 50, h: 100, type: 'win'}   
  ],
  
  // –£–†–û–í–ï–ù–¨ 2: –¢–æ–Ω–Ω–µ–ª—å (–¢–ï–ü–ï–†–¨ –ë–ï–ó –ü–û–¢–û–õ–ö–ê)
  [
    {x: 0, y: 300, w: 200, h: 50, type: 'block'},
    {x: 200, y: 350, w: 2000, h: 50, type: 'danger'}, // –ü–æ–ª –≤—Å–µ –µ—â–µ –æ–ø–∞—Å–µ–Ω!

    // –ü–æ—Ç–æ–ª–æ–∫ —É–¥–∞–ª–µ–Ω! –ü—Ä—ã–≥–∞–π —Å–∫–æ–ª—å–∫–æ —Ö–æ—á–µ—à—å.

    {x: 300, y: 250, w: 100, h: 20, type: 'block'},
    {x: 500, y: 250, w: 50, h: 20, type: 'block'},
    {x: 650, y: 200, w: 50, h: 20, type: 'block'}, 
    {x: 800, y: 250, w: 50, h: 20, type: 'block'},
    {x: 1000, y: 200, w: 50, h: 20, type: 'block'},
    {x: 1200, y: 250, w: 50, h: 20, type: 'block'},
    
    {x: 1400, y: 150, w: 200, h: 20, type: 'block'}, // –û—Ç–¥—ã—Ö
    {x: 1700, y: 250, w: 50, h: 100, type: 'win'}
  ],

  // –£–†–û–í–ï–ù–¨ 3: –í–µ—Ä—Ç–∏–∫–∞–ª—å (–ë–∞—à–Ω—è)
  [
    {x: 0, y: 500, w: 300, h: 50, type: 'block'},
    {x: 300, y: 500, w: 1000, h: 50, type: 'danger'}, 

    {x: 350, y: 400, w: 60, h: 20, type: 'block'}, 
    {x: 500, y: 300, w: 60, h: 20, type: 'block'}, 
    {x: 350, y: 200, w: 60, h: 20, type: 'block'}, 
    {x: 500, y: 100, w: 60, h: 20, type: 'block'}, 
    
    {x: 700, y: 200, w: 60, h: 20, type: 'block'}, 
    {x: 900, y: 300, w: 60, h: 20, type: 'block'},
    {x: 1100, y: 400, w: 60, h: 20, type: 'block'},
    
    {x: 1300, y: 350, w: 20, h: 150, type: 'danger'}, // –°—Ç–µ–Ω–∞ —à–∏–ø–æ–≤ –æ—Å—Ç–∞–ª–∞—Å—å
    {x: 1350, y: 250, w: 100, h: 20, type: 'block'}, 
    
    {x: 1600, y: 400, w: 50, h: 50, type: 'win'}
  ]
];

// --- –°–û–°–¢–û–Ø–ù–ò–ï ---
let currentLevelIndex = 0;
let currentLevelData = [];
const player = { x: 50, y: 100, radius: 15, dx: 0, dy: 0, grounded: false };
const keys = { left: false, right: false, jump: false };

function loadLevel(index) {
  if (index >= levels.length) index = 0;
  currentLevelIndex = index;
  currentLevelData = levels[currentLevelIndex];
  player.x = 50; player.y = 0; player.dx = 0; player.dy = 0;
  levelDisplay.innerText = currentLevelIndex + 1;
}

function resize() {
  width = window.innerWidth;
  height = window.innerHeight;
  canvas.width = width;
  canvas.height = height;
}
window.addEventListener('resize', resize);
resize();
loadLevel(0);

// --- –§–ò–ó–ò–ö–ê (–ì–õ–ê–í–ù–´–ï –ò–ó–ú–ï–ù–ï–ù–ò–Ø) ---
function update() {
  if (keys.right) if (player.dx < moveSpeed) player.dx++;
  if (keys.left) if (player.dx > -moveSpeed) player.dx--;
  
  player.dx *= friction;
  player.dy += gravity;

  // –ü—Ä—ã–∂–æ–∫ (–ü—Ä–æ—Å—Ç–æ–π –∏ –Ω–∞–¥–µ–∂–Ω—ã–π)
  if (keys.jump && player.grounded) {
    player.dy = jumpForce;
    player.grounded = false;
  }
  // –£–ë–†–ê–ù –ë–õ–û–ö –ì–ê–®–ï–ù–ò–Ø –ü–†–´–ñ–ö–ê

  player.x += player.dx;
  player.y += player.dy;
  player.grounded = false;

  // –ö–æ–ª–ª–∏–∑–∏–∏
  currentLevelData.forEach(block => {
    if (player.x > block.x - player.radius && player.x < block.x + block.w + player.radius &&
        player.y > block.y - player.radius && player.y < block.y + block.h + player.radius) {
            
      if (block.type === 'danger') { loadLevel(currentLevelIndex); return; }
      if (block.type === 'win') { loadLevel(currentLevelIndex + 1); return; }

      if (player.dy > 0 && player.y < block.y) {
         player.y = block.y - player.radius;
         player.dy = 0; 
         player.grounded = true;
      }
      else if (player.dy < 0 && player.y > block.y + block.h) {
          player.y = block.y + block.h + player.radius;
          player.dy = 0;
      }
    }
  });

  if (player.y > height + 200) loadLevel(currentLevelIndex);
}

// --- –û–¢–†–ò–°–û–í–ö–ê ---
function draw() {
  ctx.clearRect(0, 0, width, height);
  let cameraX = player.x - width / 3;
  if (cameraX < 0) cameraX = 0;

  ctx.save();
  ctx.translate(-cameraX, 0);

  currentLevelData.forEach(block => {
    if (block.type === 'win') {
        ctx.fillStyle = '#0f0'; ctx.shadowColor = '#0f0'; ctx.shadowBlur = 15;
    } else if (block.type === 'danger') {
        ctx.fillStyle = '#f00'; ctx.shadowColor = '#f00'; ctx.shadowBlur = 20;
    } else {
        ctx.fillStyle = '#444'; ctx.shadowColor = '#fff'; ctx.shadowBlur = 0;
        ctx.strokeStyle = '#0ff'; ctx.lineWidth = 2; ctx.strokeRect(block.x, block.y, block.w, block.h);
    }
    
    if (block.type !== 'block') ctx.fillRect(block.x, block.y, block.w, block.h);
    else ctx.fillRect(block.x, block.y, block.w, block.h);
  });

  ctx.beginPath();
  ctx.arc(player.x, player.y, player.radius, 0, Math.PI * 2);
  ctx.fillStyle = '#fff'; ctx.shadowColor = '#fff'; ctx.shadowBlur = 10;
  ctx.fill();
  ctx.restore();
}

function loop() { update(); draw(); requestAnimationFrame(loop); }

// --- –£–ü–†–ê–í–õ–ï–ù–ò–ï ---
const btnLeft = document.getElementById('btnLeft');
const btnRight = document.getElementById('btnRight');
const btnJump = document.getElementById('btnJump');

function bindTouch(btn, code) {
  btn.addEventListener('touchstart', (e) => { e.preventDefault(); keys[code] = true; });
  btn.addEventListener('touchend', (e) => { e.preventDefault(); keys[code] = false; });
  btn.addEventListener('mousedown', (e) => { e.preventDefault(); keys[code] = true; });
  btn.addEventListener('mouseup', (e) => { e.preventDefault(); keys[code] = false; });
  btn.addEventListener('mouseleave', (e) => { e.preventDefault(); keys[code] = false; });
}
bindTouch(btnLeft, 'left');
bindTouch(btnRight, 'right');
bindTouch(btnJump, 'jump');

document.addEventListener('keydown', (e) => {
  if (e.code === 'ArrowLeft') keys.left = true;
  if (e.code === 'ArrowRight') keys.right = true;
  if (e.code === 'Space' || e.code === 'ArrowUp') keys.jump = true;
});
document.addEventListener('keyup', (e) => {
  if (e.code === 'ArrowLeft') keys.left = false;
  if (e.code === 'ArrowRight') keys.right = false;
  if (e.code === 'Space' || e.code === 'ArrowUp') keys.jump = false;
});

loop();
</script>
</body>
</html>

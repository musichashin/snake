<!DOCTYPE html>
<html>
<head>
  <title>Neon Bounce: DOUBLE JUMP</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <style>
    body {
      margin: 0;
      background: #050505;
      overflow: hidden;
      font-family: 'Courier New', sans-serif;
      touch-action: none;
      user-select: none;
    }
    canvas {
      display: block;
      width: 100%;
      height: 100%;
    }
    #ui-layer {
      position: absolute;
      top: 20px;
      left: 20px;
      color: #0ff;
      font-size: 24px;
      font-weight: bold;
      text-shadow: 0 0 10px #0ff;
      pointer-events: none;
    }
    #controls {
      position: absolute;
      bottom: 20px;
      width: 100%;
      display: flex;
      justify-content: space-between;
      padding: 0 20px;
      box-sizing: border-box;
      pointer-events: none;
    }
    .btn {
      width: 80px;
      height: 80px;
      background: rgba(255, 255, 255, 0.1);
      border: 2px solid #555;
      border-radius: 50%;
      color: white;
      font-size: 30px;
      display: flex;
      align-items: center;
      justify-content: center;
      pointer-events: auto;
      backdrop-filter: blur(5px);
    }
    .btn:active { background: rgba(0, 255, 255, 0.4); border-color: #0ff; }
    .right-controls { display: flex; }
    .left-controls { display: flex; gap: 15px; }
  </style>
</head>
<body>

<div id="ui-layer">LVL <span id="levelDisplay">1</span> (Double Jump Ready)</div>
<canvas id="gameCanvas"></canvas>

<div id="controls">
  <div class="left-controls">
    <div class="btn" id="btnLeft">‚Üê</div>
    <div class="btn" id="btnRight">‚Üí</div>
  </div>
  <div class="right-controls">
    <div class="btn" id="btnJump">üöÄ</div>
  </div>
</div>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const levelDisplay = document.getElementById('levelDisplay');

// --- –§–ò–ó–ò–ö–ê ---
let width, height;
const gravity = 0.6; 
const friction = 0.85; 
const jumpForce = -12; // –°–∏–ª–∞ –ø–µ—Ä–≤–æ–≥–æ –ø—Ä—ã–∂–∫–∞
const doubleJumpForce = -10; // –°–∏–ª–∞ –≤—Ç–æ—Ä–æ–≥–æ –ø—Ä—ã–∂–∫–∞ (—á—É—Ç—å —Å–ª–∞–±–µ–µ)
const moveSpeed = 6;

// --- –£–†–û–í–ù–ò ---
const levels = [
  // –£–†–û–í–ï–ù–¨ 1: –†–∞–∑–º–∏–Ω–∫–∞
  [
    {x: 0, y: 300, w: 200, h: 50, type: 'block'}, 
    {x: 0, y: 400, w: 3000, h: 50, type: 'danger'}, 
    
    {x: 300, y: 250, w: 80, h: 20, type: 'block'},
    {x: 550, y: 200, w: 80, h: 20, type: 'block'}, 
    {x: 800, y: 150, w: 80, h: 20, type: 'block'},
    {x: 1100, y: 250, w: 80, h: 20, type: 'block'}, 
    {x: 1350, y: 300, w: 80, h: 20, type: 'block'}, 
    {x: 1600, y: 200, w: 50, h: 20, type: 'block'}, 
    {x: 1800, y: 250, w: 50, h: 100, type: 'win'}   
  ],
  
  // –£–†–û–í–ï–ù–¨ 2: –ü—Ä–æ—Å—Ç–æ—Ä
  [
    {x: 0, y: 300, w: 200, h: 50, type: 'block'},
    {x: 200, y: 350, w: 2000, h: 50, type: 'danger'}, 

    {x: 300, y: 250, w: 100, h: 20, type: 'block'},
    {x: 500, y: 250, w: 50, h: 20, type: 'block'},
    {x: 650, y: 200, w: 50, h: 20, type: 'block'}, 
    {x: 800, y: 250, w: 50, h: 20, type: 'block'},
    {x: 1000, y: 200, w: 50, h: 20, type: 'block'},
    {x: 1200, y: 250, w: 50, h: 20, type: 'block'},
    
    {x: 1400, y: 150, w: 200, h: 20, type: 'block'},
    {x: 1700, y: 250, w: 50, h: 100, type: 'win'}
  ],

  // –£–†–û–í–ï–ù–¨ 3: –í–µ—Ä—Ç–∏–∫–∞–ª—å (–¢–µ–ø–µ—Ä—å –ø—Ä–æ—Ö–æ–¥–∏–º–∞!)
  [
    {x: 0, y: 500, w: 300, h: 50, type: 'block'},
    {x: 300, y: 500, w: 1000, h: 50, type: 'danger'}, 

    {x: 350, y: 400, w: 60, h: 20, type: 'block'}, 
    {x: 500, y: 300, w: 60, h: 20, type: 'block'}, 
    {x: 350, y: 200, w: 60, h: 20, type: 'block'}, 
    {x: 500, y: 100, w: 60, h: 20, type: 'block'}, 
    
    {x: 700, y: 200, w: 60, h: 20, type: 'block'}, 
    {x: 900, y: 300, w: 60, h: 20, type: 'block'},
    {x: 1100, y: 400, w: 60, h: 20, type: 'block'},
    
    {x: 1300, y: 350, w: 20, h: 150, type: 'danger'}, // –°—Ç–µ–Ω–∞ —à–∏–ø–æ–≤
    {x: 1350, y: 250, w: 100, h: 20, type: 'block'}, // –ü–µ—Ä–µ–ª–µ—Ç–∞–µ–º —Å –¥–≤–æ–π–Ω—ã–º –ø—Ä—ã–∂–∫–æ–º!
    
    {x: 1600, y: 400, w: 50, h: 50, type: 'win'}
  ]
];

// --- –°–û–°–¢–û–Ø–ù–ò–ï ---
let currentLevelIndex = 0;
let currentLevelData = [];
const player = { 
    x: 50, y: 100, radius: 15, 
    dx: 0, dy: 0, 
    grounded: false,
    jumpCount: 0 // –°–ß–ï–¢–ß–ò–ö –ü–†–´–ñ–ö–û–í
};
const keys = { left: false, right: false, jump: false, jumpPressed: false };

function loadLevel(index) {
  if (index >= levels.length) index = 0;
  currentLevelIndex = index;
  currentLevelData = levels[currentLevelIndex];
  player.x = 50; player.y = 0; player.dx = 0; player.dy = 0;
  player.jumpCount = 0;
  levelDisplay.innerText = currentLevelIndex + 1;
}

function resize() {
  width = window.innerWidth;
  height = window.innerHeight;
  canvas.width = width;
  canvas.height = height;
}
window.addEventListener('resize', resize);
resize();
loadLevel(0);

// --- –§–ò–ó–ò–ö–ê ---
function update() {
  if (keys.right) if (player.dx < moveSpeed) player.dx++;
  if (keys.left) if (player.dx > -moveSpeed) player.dx--;
  
  player.dx *= friction;
  player.dy += gravity;

  // –õ–û–ì–ò–ö–ê –î–í–û–ô–ù–û–ì–û –ü–†–´–ñ–ö–ê
  // –ú—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ñ–ª–∞–≥ jumpPressed, —á—Ç–æ–±—ã –ø—Ä—ã–∂–æ–∫ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–ª –æ–¥–∏–Ω —Ä–∞–∑ –∑–∞ –Ω–∞–∂–∞—Ç–∏–µ
  if (keys.jump && !keys.jumpPressed) {
      // –ï—Å–ª–∏ –º—ã –Ω–∞ –∑–µ–º–ª–µ –ò–õ–ò –µ—Å–ª–∏ –º—ã –≤ –≤–æ–∑–¥—É—Ö–µ –∏ —ç—Ç–æ –≤—Ç–æ—Ä–æ–π –ø—Ä—ã–∂–æ–∫
      if (player.grounded || player.jumpCount < 2) {
          player.dy = (player.jumpCount === 0) ? jumpForce : doubleJumpForce;
          player.jumpCount++;
          player.grounded = false;
      }
      keys.jumpPressed = true; // –ë–ª–æ–∫–∏—Ä—É–µ–º, –ø–æ–∫–∞ –Ω–µ –æ—Ç–ø—É—Å—Ç–∏—Ç –∫–Ω–æ–ø–∫—É
  }

  if (!keys.jump) {
      keys.jumpPressed = false; // –°–±—Ä–æ—Å –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –∫–Ω–æ–ø–∫–∏
  }

  player.x += player.dx;
  player.y += player.dy;
  player.grounded = false;

  // –ö–æ–ª–ª–∏–∑–∏–∏
  currentLevelData.forEach(block => {
    if (player.x > block.x - player.radius && player.x < block.x + block.w + player.radius &&
        player.y > block.y - player.radius && player.y < block.y + block.h + player.radius) {
            
      if (block.type === 'danger') { loadLevel(currentLevelIndex); return; }
      if (block.type === 'win') { loadLevel(currentLevelIndex + 1); return; }

      if (player.dy > 0 && player.y < block.y) {
         player.y = block.y - player.radius;
         player.dy = 0; 
         player.grounded = true;
         player.jumpCount = 0; // –°–ë–†–ê–°–´–í–ê–ï–ú –°–ß–ï–¢–ß–ò–ö –ü–†–ò –ö–ê–°–ê–ù–ò–ò –ó–ï–ú–õ–ò
      }
      else if (player.dy < 0 && player.y > block.y + block.h) {
          player.y = block.y + block.h + player.radius;
          player.dy = 0;
      }
    }
  });

  if (player.y > height + 200) loadLevel(currentLevelIndex);
}

// --- –û–¢–†–ò–°–û–í–ö–ê ---
function draw() {
  ctx.clearRect(0, 0, width, height);
  let cameraX = player.x - width / 3;
  if (cameraX < 0) cameraX = 0;

  ctx.save();
  ctx.translate(-cameraX, 0);

  currentLevelData.forEach(block => {
    if (block.type === 'win') {
        ctx.fillStyle = '#0f0'; ctx.shadowColor = '#0f0'; ctx.shadowBlur = 15;
    } else if (block.type === 'danger') {
        ctx.fillStyle = '#f00'; ctx.shadowColor = '#f00'; ctx.shadowBlur = 20;
    } else {
        ctx.fillStyle = '#444'; ctx.shadowColor = '#fff'; ctx.shadowBlur = 0;
        ctx.strokeStyle = '#0ff'; ctx.lineWidth = 2; ctx.strokeRect(block.x, block.y, block.w, block.h);
    }
    
    if (block.type !== 'block') ctx.fillRect(block.x, block.y, block.w, block.h);
    else ctx.fillRect(block.x, block.y, block.w, block.h);
  });

  // –®–∞—Ä –º–µ–Ω—è–µ—Ç —Ü–≤–µ—Ç, –µ—Å–ª–∏ –µ—Å—Ç—å –≤—Ç–æ—Ä–æ–π –ø—Ä—ã–∂–æ–∫
  ctx.beginPath();
  ctx.arc(player.x, player.y, player.radius, 0, Math.PI * 2);
  
  // –ï—Å–ª–∏ –µ—â–µ –º–æ–∂–Ω–æ –ø—Ä—ã–≥–Ω—É—Ç—å –≤ –≤–æ–∑–¥—É—Ö–µ - —à–∞—Ä –±–µ–ª—ã–π, –µ—Å–ª–∏ –Ω–µ—Ç - —Å–µ—Ä—ã–π
  if (player.jumpCount < 2) ctx.fillStyle = '#fff'; 
  else ctx.fillStyle = '#888';

  ctx.shadowColor = '#fff'; ctx.shadowBlur = 10;
  ctx.fill();
  ctx.restore();
}

function loop() { update(); draw(); requestAnimationFrame(loop); }

// --- –£–ü–†–ê–í–õ–ï–ù–ò–ï ---
const btnLeft = document.getElementById('btnLeft');
const btnRight = document.getElementById('btnRight');
const btnJump = document.getElementById('btnJump');

function bindTouch(btn, code) {
  btn.addEventListener('touchstart', (e) => { e.preventDefault(); keys[code] = true; });
  btn.addEventListener('touchend', (e) => { e.preventDefault(); keys[code] = false; });
  btn.addEventListener('mousedown', (e) => { e.preventDefault(); keys[code] = true; });
  btn.addEventListener('mouseup', (e) => { e.preventDefault(); keys[code] = false; });
  btn.addEventListener('mouseleave', (e) => { e.preventDefault(); keys[code] = false; });
}
bindTouch(btnLeft, 'left');
bindTouch(btnRight, 'right');
bindTouch(btnJump, 'jump');

document.addEventListener('keydown', (e) => {
  if (e.code === 'ArrowLeft') keys.left = true;
  if (e.code === 'ArrowRight') keys.right = true;
  if (e.code === 'Space' || e.code === 'ArrowUp') keys.jump = true;
});
document.addEventListener('keyup', (e) => {
  if (e.code === 'ArrowLeft') keys.left = false;
  if (e.code === 'ArrowRight') keys.right = false;
  if (e.code === 'Space' || e.code === 'ArrowUp') keys.jump = false;
});

loop();
</script>
</body>
</html>
